@model WebApplication5.Models.GeneratePOViewModel

@{
    //var uni = ViewBag.University as WebApplication5.Models.University;

    Layout = "~/Views/Shared/_StoreAdminLayout.cshtml";
    ViewBag.Title = "Purchase Order";
    var today = DateTime.Now.ToString("dd-MM-yyyy");
}

<style>
    .po-container {
        border: 2px solid black;
        padding: 30px;
        max-width: 800px;
        height: auto;
        margin: auto;
        font-family: Arial, sans-serif;
    }

    .po-title {
        font-size: 28px;
        font-weight: bold;
        text-align: right;
    }

    .company-header {
        font-size: 16px;
        font-weight: bold;
    }

    table {
        width: 100%;
        height: 50px;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        border: 1px solid black;
        padding: 6px;
        text-align: left;
    }

    .no-border {
        border: none;
    }

    .signature {
        margin-top: 50px;
        text-align: right;
    }

    .btn-secondary {
        margin-top: 30px;
        text-align: center;
        background-color:blue;
    }

    .company-header {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 5px;
    }

    .po-title {
        font-size: 18px;
        font-weight: bold;
    }
    footer{
        position:fixed;
    }
    .input-no-border {
        width: 100%;
        border: none;
        border-bottom: 1px solid black;
    }
</style>
@if (ViewBag.SuccessMessage != null)
{
    <div class="alert alert-success">@ViewBag.SuccessMessage</div>
}


<div class="po-container">
    <!-- Search bar to fetch PO Details -->
    <h2>Local Purchase Order</h2>

    @using (Html.BeginForm("PODetails", "Home", FormMethod.Post))
    {
        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Enter PO Number:</label>
            <div class="col-sm-4">
                <input type="text" name="poNumber" class="form-control" placeholder="PO123" required />
            </div>
            <div class="col-sm-2">
                <button type="submit" class="btn btn-primary">Fetch</button>
            </div>
        </div>
    }

    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
    }


    @if (Model != null)
    {


        <div class="d-flex justify-content-between">
            <!-- Left side: University details stacked vertically -->
            <div>

                <div class="company-header">@Model.UniversityName</div>
                <div>@Model.UniversityAddress</div>
                <div>Email: @Model.UniversityEmail</div>
                <div>Phone: @Model.UniversityPhone</div>

            </div>

            <!-- Right side: PO title -->
            <div class="po-title text-end">
                <div>Purchase Order</div>
                <div style="font-size: 14px;">PO No: @Model.PONumber</div>
            </div>
        </div>

        <!-- Displaying the PO details -->
        <table>
            <tr>
                <td><strong>Date:</strong> @Model.PODate</td>
                <td><strong>Requisition No:</strong> @Model.RequisitionNo</td>
            </tr>

            <tr>
                <td colspan="2">
                    <strong>Ship To:</strong> @Model.ShipTo
                </td>
            </tr>
        </table>

        <table>
            <tr>
                <th>Requisitioned By</th>
                <th>When Ship</th>
                <th>Ship Via</th>
                <th>F.O.B. Point</th>
                <th>Terms</th>
            </tr>
            <tr>
                <td>@Model.RequisitionedBy</td>
                <td>@Model.WhenShip</td>
                <td>@Model.ShipVia</td>
                <td>@Model.FOBPoint</td>
                <td>@Model.Terms</td>
            </tr>
        </table>




        using (Html.BeginForm("UpdatePOItems", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.HiddenFor(m => m.PONumber)

            <table class="table">
                <tr>
                    <th>Order Qty</th>
                    <th>Received Qty</th>
                    <th>Description</th>
                    <th>Remarks</th>
                </tr>

                @for (int i = 0; i < Model.PurchaseOrderItems.Count; i++)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(m => m.PurchaseOrderItems[i].QtyOrdered)
                        </td>
                        <td>
                            <input type="number" class="form-control" name="PurchaseOrderItems[@i].QtyReceived"
                                   value="@Model.PurchaseOrderItems[i].QtyReceived" min="0" />
                            <input type="hidden" name="PurchaseOrderItems[@i].POItemID"
                                   value="@Model.PurchaseOrderItems[i].POItemID" />
                        </td>
                        <td>
                            @Html.DisplayFor(m => m.PurchaseOrderItems[i].Description)
                        </td>
                        <td>
                            <input type="text" class="form-control" name="PurchaseOrderItems[@i].Remarks"
                                   value="@Model.PurchaseOrderItems[i].Remarks" />
                        </td>
                    </tr>
                }
            </table>

            if (!string.IsNullOrEmpty(Model.StoreUploads))
            {
                <div class="mt-2">
                    <label>Previously Uploaded Certificate:</label>
                    <a href="@Url.Content(Model.StoreUploads)" target="_blank">View Certificate</a>
                </div>
            }
            else
            {

                <div class="form-group">
                    <label>Upload Certification Document</label>
                    <input type="file" name="CertificationFile" class="form-control" accept=".pdf,.doc,.docx" />

                </div>
            }

            <div class="text-end mt-3">
                <button type="submit" class="btn btn-success">Save Updates</button>
            </div>
            <div class="text-lg-center mt-3">
                <button type="button" class="btn btn-secondary" onclick="window.print()">Print PO</button>
            </div>

        }


        <div style="font-size: 13px; margin-top: 10px;">
            <p>
                1. Please send @Model.CopiesOfInvoice copies of your invoice.
            </p>

            <p>2. Order is to be entered in accordance with prices, delivery and specifications shown above.</p>
            <p>3. Notify us immediately if you are unable to ship as specified.</p>
        </div>


        <div class="signature">

            <strong>AUTHORIZED BY</strong><br />
            @Model.AuthorizedBy
            <br /><br />

            @*<div class="text-lg-center mt-3">
                    <button type="button" class="btn btn-secondary" onclick="window.print()">Print PO</button>
                </div>*@

        </div>
    }

</div>

